# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

Проект предполагает использование паттерна MVP, при котором проект разделяется на слои: 
1. Модель (Model) - отвечает за хранение и обработку данных проекта (в частности, в проекте используются следующие данные - данные о товарах (выводимые на главную страницу в каталог, а также имеется более развернутое описание каждого товара, выводимое в модальном окне), данные о состоянии корзины товаров (количество товаров в корзине, перечисление товаров со стоимостью каждого товара, общая стоимость всех товаров в корзине), данные о покупке (способ оплаты, адрес доставки, контактные данные покупателя: email и телефон)).
2. Отображения (View) - отвечает за демонстрацию HTML-элементов на экране. В проекте имеется главная страница, где будет размещен каталог карточек товаров, модальные окна, в которые размещаются: развернутое описание товара, корзина покупок, две формы, заполняемые при оформлении заказа, уведомление об успешном оформлении заказа.
3. Презентер (Presenter) - отвечает за взаимодействие модели и отображений. В рамках данного слоя не будет выделяться отдельных классов. Размещается в файле index.ts, являющемся точкой входа в проект. Будет содержать основную бизнес-логику проекта. Здесь данные, полученные в модели, передаются в компоненты отображения, отдаются команды что демонстрировать на экране. Кроме того, в данном файле будут содержаться различные обработчики событий, т.е. предусмотрена реакция на действия пользователя (или иные события).


Кроме того, в проекте есть некоторые базовые компоненты, которые сложно отнести к тому или иному слою. В частности, брокер событий - EventEmitter, который позволяет создавать события и подписываться на них.

### Базовые компоненты

__Класс Api__

Позволяет направлять, получать и обрабатывать данные с сервера. 

Свойства класса:
* baseUrl: string - поле хранит адрес сервера, куда будут направляться запросы.
* options: RequestInit - поле хранит настройки запроса на сервер.

Конструктор класса: получает в качестве параметров адрес сервера, объект настроек (по умолчанию пустой), настраивает параметры для запросов на сервер, устанавливая базовый URL и объединяя стандартные заголовки с пользовательскими заголовками, если таковые имеются.

Методы класса:
* handleResponse(response: Response) - обрабатывает ответ с сервера, принимает в параметры ответ сервера типа Response, возвращает промис.
* get(uri: string) - позволяет получить данные с сервера, принимает в параметры адрес url строкового типа для отправки запроса.
* post(uri: string, data: object, method: ApiPostMethods = 'POST') - позволяет направить данные на сервер, принимает адрес сервера строкового типа, объект с данными, метод типа ApiPostMethods.

__Класс Model__

Является абстрактным классом, служит основой для создания других классов, обеспечивая общую функциональность для управления данными и обработки событий. 

Конструктор класса: получает в качестве параметров данные, которые частично соответствуют обобщенному типу Т, а также получает объект events, который соответствует интерфейсу IEvents. Внутри конструктора происходит инициализация свойств модели на основе предоставленных данных.

Методы класса: 
* emitChanges(event: string, payload?: object) - предназначен для уведомления всех подписчиков о каком-либо событии, принимает имя события, о котором будет оповещение (в строчном типе), необязательный параметр payload - объект, в котором могут быть дополнительные данные, которые будут отправлены вместе с событией.

__Класс Component__ 

Является абстрактным классом, позволяет управлять DOM-элементами. Полей не содержит.

Конструктор класса: принимает в параметры контейнер, в котором будет размещен элемент. 

Методы класса: 
* toggleClass(element: HTMLElement, className: string, force?: boolean)  - переключает класс элемента, в качестве парамаетром принимает элемент, относительно которого производится действие, название класса, которое применяется к элементу, булево значение для применения или удаления класса.
* setText(element: HTMLElement, value: string) - устанавливает текстовое содержимое элемента. 
* setDisabled(element: HTMLElement, state: boolean) - переключает статус блокировки элемента.
* setHidden(element: HTMLElement) - скрывает элемент.
* setVisible(element: HTMLElement)- показывает элемент.
* setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение.
* render(data?: Partial<T>): HTMLElement - возвращает корневой элемент после обновления данных.

__Класс EventEmitter__

Предназначен для управления событиями и их подписчиками. 

В поле events хранится массив названий событий и подписчиков на данные события.

Конструктор класса: инициализирует значение поля.

Методы класса:
* on<T extends object>(eventName: EventName, callback: (event: T) => void) - устанавливает обработчик на указанное событие, в параметры принимает название события и функцию - обработчик.
* off(eventName: EventName, callback: Subscriber) - удаляет обработчик с указанного события, принимает также название события и функцию, которую нужно удалить.
* emit<T extends object>(eventName: string, data?: T) - вызывает обработчик для определенного события, принимает название события и опционально дополнительные сведения.
* onAll(callback: (event: EmitterEvent) => void) - устанавливает обработчик, который будет вызываться для всех событий, в параметры принимает этот обработчик.
* offAll - сбрасывает все обработчики событий
* trigger<T extends object>(eventName: string, context?: Partial<T>) - создает функцию-колбек, генерирующую событие при вызове. В параметры принимает название события и опционально дополнительные данные.

### *МОДЕЛЬ*

__Класс AppState__

Класс является наследником абстрактного класса Model. Представляет собой модель состояния приложения. Этот класс управляет различными аспектами состояния приложения, такими как корзина, каталог товаров и информация о заказе.

Поля класса:
* basket - хранит информацию о товарах в корзине, содержит массив объектов, соответствующих IProductItem.
* catalog - текущий каталог товаров, содержит массив объектов, соответствующих IProductItem.
* orderInfo - объект, представляющий данные по текущему заказу, включая платежную информацию, адрес и контактные данные. Соответствует интерфейсу IOrderModel.
* formErrors - хранит информацию об ошибках ввода форм заказа товара, по умолчанию инициализирован пустым объектом.

Конструктор класса: наследуется от родительского класса. (?)

Методы класса:
* setCatalog(data: IProductItem[]) - позволяет обновить каталог товаров при получении данных с сервера.
* addToBasket(id: string) - позволяет добавить товар в массив корзины, в параметры принимает идентификатор товара, который необходимо добавить.
* removeFromBasket(id: string) - позволяет удалить товар из корзины, в параметры принимает идентификатор товара, который необходимо удалить.
* clearBasket() - очищает корзину, удаляя все товары из нее (например, после оформления заказа).
* getTotalPrice(): number - рассчитывает и возвращает общую стоимость товаров в корзине, суммируя цены всех товаров, которые находятся в корзине.
* countProducts(): number - счетчик количества товаров в корзине, возвращает число товаров.
* setOrderField(field: keyof IOrderModel, value: string) - предусмотрено для записывания значения в поля заказа. В параметры принимает какое-либо из полей, имеющихся в интерфейсе IOrderModel, и его значение. 
* validateAdress() - проверяет валидность первой формы при оформлении заказа, где выбирается способ оплаты и вводится адрес покупателя. Возвращает булево значение.
* validateContacts() - позволяет проверить валидность контактных данных покупателя. Возвращает булево значение.

### *ОТОБРАЖЕНИЕ*

__Класс Modal__

Представляет собой базовый компонент модального окна, который управляет его отображением и закрытием, а также взаимодействует с событиями. Является наследником класса Component.

Поля класса:
Будут сохранены такие элементы разметки, которые содержат кнопку закрытия модального окна и основное содержание. 

Конструктор класса: 
в качестве параметров принимает родительский элемент и объект, соответствующий интерфейсу IEvents. Внутри конструктора происходит инициализация полей и навешивание обработчиков событий для закрытия окна по клику на кнопку или за пределами модального окна.

Методы класса: 
* сеттер для содержимого модального окна.
* open() - открывает модальное окно.
* close() - закрывает модальное окно.
* render(data: IModalData): HTMLElement - обновляет содержимое модального окна на основе переданных данных.

__Класс Form__

Представляет собой базовый компонент формы, который предоставляет обший функционал для двух форм, имеющихся на сайте. Является наследником класса Component, соответствует интерфейсу IFormState.

Поля класса: 
Будут сохранены элементы разметки, которые содержат ошибки валидации, кнопку для продолжения оформления заказа / кнопку подтверждения и оплаты заказа (?).

Конструктор класса: 
в качестве параметров принимает родительский элемент формы, который содержит элементы формы, и объект, соответствующий интерфейсу IEvents. 

Методы класса: 
* onInputChange(field: keyof T, value: string) - oбрабатывает изменение значения в поле формы.
* сеттер valid(value: boolean) - устанавливает состояние кнопки отправки формы в зависимости от значения valid.
* сеттер errors(value: string) - устанавливает текст ошибок в элементе.
* render(state: Partial<T> & IFormState) - обновляет состояние формы на основе переданных данных о состоянии формы (valid, erorrs, inputs).

__Класс Page__

Позволяет отобразить главную страницу приложения и изменять ее при необходимости. Является наследником класса Component. 

Поля класса: 
* counter: HTMLElement - элемент, отображающий счётчик товаров в корзине в заголовке.
* catalog: HTMLElement - элемент, содержащий каталог товаров. 
* basket: HTMLElement - элемент, представляющий корзину, на который можно кликнуть для открытия или отображения корзины.

Конструктор класса: 
в качестве параметров принимает родительский элемент и объект, соответствующий интерфейсу IEvents. Внутри конструктора происходит инициализация полей и навешивание обработчика для открытия корзины товаров.

Методы класса:
для counter и catalog будут предусмотрены сеттеры.

__Класс Card__

Наполняет содержимым и отрисовывает карточку товара. Является наследником класса Component. 

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат название, описание, изображение, категорию товара, его стоимость, выбран товар или нет. 

Конструктор класса: 
принимает параметры имя блока строчного типа (для последующего поиска полей в разметке), родительский контейнер (тип HTMLElement), может также принимать объект actions, который можно использовать при навешивании обработчиков событий. 

Содержит сеттеры и геттеры для получения и установления значения полей карточки.

__Класс Basket__

Управляет отображением содержимого корзины. Является наследником класса Component. 

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат список товаров, общую стоимость товаров, кнопку оформления заказа.

Конструктор класса: 
В качестве параметров принимает родительский контейнер (тип HTMLElement) и объект, соответствующий интерфейсу IEvents.

Методы класса: 
* для полей со списком товаров и стоимостью товаров будут предусмотрены сеттеры. 
* disableBasketBtn - позволяет заблокировать кнопку "Оформить", если корзина пуста.

__Класс PopupOrder__

Управляет формой заказа. Является наследником класса Form. 

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат форму, кнопки выбора способа оплаты, поле ввода адреса. 

Конструктор класса: в качестве параметра принимает шаблон формы и объект, соответствующий интерфейсу IEvents. В конструкторе происходит инициализация полей, навешивание слушателей событий на кнопки и инпут.

__Класс PopupContacts__

Управляет формой заполнения контактных данных. Является наследником класса Form. 

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат форму, два поля ввода контактной информации. 

Конструктор класса: в качестве параметра принимает шаблон формы и объект, соответствующий интерфейсу IEvents. В конструкторе происходит инициализация полей, навешивание слушателей событий на кнопку и инпуты.

__Класс PopupSucces__

Управляет отображением окна успешного оформления заказа. Является наследником класса Component.

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат кнопку закрытия, списанную сумму за заказ.

Конструктор класса: 
принимает в качестве параметров родительский элемент, содержащий компоненты сообщения об успехе, и объект actions: ISuccessActions, содержащий действия, которые могут быть выполнены в ответ на события, происходящие в компоненте (в частности, для обработки клика по кнопке закрытия).

Методы класса: 
* будет предусмотрен сеттер для указания списанной суммы (в параметры принимает сумму).


### События в проекте:

В проекте будет использован ряд событий, о которых будут оповещаться подписчики. 

* catalog:changed - обновление списка товаров на странице. Изначально массив товаров получается с сервера через экземпляр класса Api и записывается в поле catalog класса AppState. Далее требуется перерисовать страницу, это можно сделать с помощью класса Page и Card. (?)
* card:selected - по клику на карточку на главной странице открывается модальное окно с подробным описанием товара
* card:addBasket - при клике на кнопку "в корзину" выбранный товар должен добавиться в массив товаров, хранящийся в корзине, при этом также обновляется счетчик товаров в корзине, а кнопка "в корзину" становится неактивной
* basket:opened - открытие корзины в модальном окне по клику на кнопку на главной странице, задействует как слой представления, так и модель, поскольку требуется отобразить массив товаров, находяшихся в корзине
* basket:removeProduct - товар удаляется из массива товаров в корзине, перерисовывается корзина, обновляется счетчик товаров, кнопка "в корзину" у товара должна быть снова активной
* basket:makeOrder - при клике на кнопку "оформить" должно открываться новое окно с формой заказа (выбора способа оплаты и ввода адреса)
* order:submit - при клике на кнопку "далее" в форме заказа должно открываться окно с заполнением контактных данных
* contacts:submit - при клике на кнопку "оплатить" в форме заполнения контактных данных информация о заказе отправляется на сервер
* order:success - инициируется при успешной обработке заказа на сервере, открывает модальное окно с сообщением об успешной покупке
* modal:closed - вызывается при нажатии на кнопку закрытия модального окна или при клике на область вне модального окна

