# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта

Проект предполагает использование паттерна MVP, при котором проект разделяется на слои: 
1. Модель (Model) - отвечает за хранение и обработку данных проекта (в частности, в проекте используются следующие данные - данные о товарах (выводимые на главную страницу в каталог, а также имеется более развернутое описание каждого товара, выводимое в модальном окне), данные о состоянии корзины товаров (количество товаров в корзине, перечисление товаров со стоимостью каждого товара, общая стоимость всех товаров в корзине), данные о покупке (способ оплаты, адрес доставки, контактные данные покупателя: email и телефон)).
2. Отображения (View) - отвечает за демонстрацию HTML-элементов на экране. В проекте имеется главная страница, где будет размещен каталог карточек товаров, модальные окна, в которые размещаются: развернутое описание товара, корзина покупок, две формы, заполняемые при оформлении заказа, уведомление об успешном оформлении заказа.
3. Презентер (Presenter) - отвечает за взаимодействие модели и отображений. В рамках данного слоя не будет выделяться отдельных классов. Размещается в файле index.ts, являющемся точкой входа в проект. Будет содержать основную бизнес-логику проекта. Здесь данные, полученные в модели, передаются в компоненты отображения, отдаются команды что демонстрировать на экране. Кроме того, в данном файле будут содержаться различные обработчики событий, т.е. предусмотрена реакция на действия пользователя (или иные события).


Кроме того, в проекте есть некоторые базовые компоненты.

### Базовые компоненты

__Класс Api__

Позволяет направлять, получать и обрабатывать данные с сервера. 

Свойства класса:
* baseUrl: string - поле хранит адрес сервера, куда будут направляться запросы.
* options: RequestInit - поле хранит настройки запроса на сервер.

Конструктор класса: получает в качестве параметров адрес сервера, объект настроек (по умолчанию пустой), настраивает параметры для запросов на сервер, устанавливая базовый URL и объединяя стандартные заголовки с пользовательскими заголовками, если таковые имеются.

Методы класса:
* handleResponse(response: Response) - обрабатывает ответ с сервера, принимает в параметры ответ сервера типа Response, возвращает промис.
* get(uri: string) - позволяет получить данные с сервера, принимает в параметры адрес url строкового типа для отправки запроса.
* post(uri: string, data: object, method: ApiPostMethods = 'POST') - позволяет направить данные на сервер, принимает адрес сервера строкового типа, объект с данными, метод типа ApiPostMethods.

__Класс Model__

Является абстрактным классом, служит основой для создания других классов, обеспечивая общую функциональность для управления данными и обработки событий. 

Конструктор класса: получает в качестве параметров данные, которые частично соответствуют обобщенному типу Т, а также получает объект events, который соответствует интерфейсу IEvents. Внутри конструктора происходит инициализация свойств модели на основе предоставленных данных.

Методы класса: 
* emitChanges(event: string, payload?: object) - предназначен для уведомления всех подписчиков о каком-либо событии, принимает имя события, о котором будет оповещение (в строчном типе), необязательный параметр payload - объект, в котором могут быть дополнительные данные, которые будут отправлены вместе с событией.

__Класс Component__ 

Является абстрактным классом, позволяет управлять DOM-элементами. Полей не содержит.

Конструктор класса: принимает в параметры контейнер, в котором будет размещен элемент. 

Методы класса: 
* toggleClass(element: HTMLElement, className: string, force?: boolean)  - переключает класс элемента, в качестве параметра принимает элемент, относительно которого производится действие, название класса, которое применяется к элементу, булево значение для применения или удаления класса.
* setText(element: HTMLElement, value: string) - устанавливает текстовое содержимое элемента. 
* setDisabled(element: HTMLElement, state: boolean) - переключает статус блокировки элемента.
* setHidden(element: HTMLElement) - скрывает элемент.
* setVisible(element: HTMLElement)- показывает элемент.
* setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение.
* render(data?: Partial<T>): HTMLElement - возвращает корневой элемент после обновления данных.

__Класс EventEmitter__

Предназначен для управления событиями и их подписчиками. 

В поле events хранится массив названий событий и подписчиков на данные события.

Конструктор класса: инициализирует значение поля.

Методы класса:
* on<T extends object>(eventName: EventName, callback: (event: T) => void) - устанавливает обработчик на указанное событие, в параметры принимает название события и функцию - обработчик.
* off(eventName: EventName, callback: Subscriber) - удаляет обработчик с указанного события, принимает также название события и функцию, которую нужно удалить.
* emit<T extends object>(eventName: string, data?: T) - вызывает обработчик для определенного события, принимает название события и опционально дополнительные сведения.
* onAll(callback: (event: EmitterEvent) => void) - устанавливает обработчик, который будет вызываться для всех событий, в параметры принимает этот обработчик.
* offAll - сбрасывает все обработчики событий
* trigger<T extends object>(eventName: string, context?: Partial<T>) - создает функцию-колбек, генерирующую событие при вызове. В параметры принимает название события и опционально дополнительные данные.

### *МОДЕЛЬ*

__Класс AppState__

Класс является наследником абстрактного класса Model. Представляет собой модель состояния приложения. Этот класс управляет различными аспектами состояния приложения, такими как корзина, каталог товаров и информация о заказе.

Поля класса:
* basket - хранит информацию о товарах в корзине, содержит массив объектов, соответствующих IProductItem.
* catalog - текущий каталог товаров, содержит массив объектов, соответствующих IProductItem.
* orderInfo - объект, представляющий данные по текущему заказу, включая платежную информацию, адрес и контактные данные. Соответствует интерфейсу IOrderModel.
* preview - хранит id строкового типа выбранной карточки товара; если карточка не выбрана, поле соответствует null.
* formErrors - хранит информацию об ошибках ввода форм заказа товара, по умолчанию инициализирован пустым объектом.

Методы класса:
* setCatalog(data: IProductItem[]) - позволяет обновить каталог товаров при получении данных с сервера.
* addToBasket(data: IProductItem) - позволяет добавить товар в массив корзины, в параметры принимает объект типа IProductItem, который необходимо добавить в корзину.
* removeFromBasket(data: IProductItem) - позволяет удалить товар из корзины, в параметры принимает объект типа IProductItem, который необходимо удалить.
* clearBasket() - очищает корзину, удаляя все товары из нее (например, после оформления заказа).
* isInBasket(productId: string): boolean - проверяет находится ли товар в корзине, возвращая булево значение.
* getTotalPrice(): number - рассчитывает и возвращает общую стоимость товаров в корзине, суммируя цены всех товаров, которые находятся в корзине.
* countProducts(): number - счетчик количества товаров в корзине, возвращает число товаров.
* setPreview(item:  IProductItem) - позволяет записать id в поле preview, а также генерирует событие card:select.
* setOrderField(field: keyof IOrderModel, value: string) - позволяет записать значения в поля заказа. В параметры принимает какое-либо из полей, имеющихся в интерфейсе IOrderModel, и его значение. 
* validateAdress() - проверяет валидность первой формы при оформлении заказа, где выбирается способ оплаты и вводится адрес покупателя. Возвращает булево значение.
* validateContacts() - позволяет проверить валидность контактных данных покупателя. Возвращает булево значение.
* getProductIDs() - позволяет сформировать массив id товаров, находящихся в корзине.

__Класс ApiAddition__

Класс является наследником базового класса Api и добавляет дополнительные возможности для работы с API, включая обработку изображений и отправку заказов.

Поля класса:
* cdn: string - содержит базовый URL для CDN. Используется для формирования полного пути к изображению продукта.

Конструктор класса: 
в качестве параметров принимает базовый URL CDN, базовый URL для API, который передается в конструктор родительского класса Api, и необязательный объект настроек. Внутри конструктора происходит вызов родительского конструктора и инициализация поля cdn.

Методы класса: 
* getCatalog() - позволяет получить список товаров с сервера и формирует полный URL для изображений товаров, добавляя базовый URL CDN. Возвращает промис.
* orderProducts(order: IOrderModel, total: number, items: string[]) - отправляет запрос на сервер для размещения заказа, включая информацию о заказе, общей сумме и списке идентификаторов товаров. Возвращает промис.

### *ОТОБРАЖЕНИЕ*

__Класс Modal__

Представляет собой базовый компонент модального окна, который управляет его отображением и закрытием, а также взаимодействует с событиями. Является наследником класса Component.

Поля класса:
сохранены такие элементы разметки, которые содержат кнопку закрытия модального окна и основное содержание. 

Конструктор класса: 
в качестве параметров принимает родительский элемент и объект, соответствующий интерфейсу IEvents. Внутри конструктора происходит инициализация полей и навешивание обработчиков событий для закрытия окна по клику на кнопку или за пределами модального окна.

Методы класса: 
* сеттер для содержимого модального окна.
* open() - открывает модальное окно.
* close() - закрывает модальное окно.
* render(data: IModalData): HTMLElement - обновляет содержимое модального окна на основе переданных данных.

__Класс Form__

Представляет собой базовый компонент формы, который предоставляет общий функционал для двух форм, имеющихся на сайте. Является наследником класса Component, соответствует интерфейсу IFormState.

Поля класса: 
сохранены элементы разметки, которые содержат ошибки валидации, кнопку для сабмита формы.

Конструктор класса: 
в качестве параметров принимает родительский элемент формы, который содержит элементы формы, и объект, соответствующий интерфейсу IEvents. Внутри конструктора происходит инициализация полей, навешивание слушателей событий.

Методы класса: 
* onInputChange(field: keyof T, value: string) - oбрабатывает изменение значения в поле формы.
* сеттер valid(value: boolean) - устанавливает состояние кнопки отправки формы в зависимости от значения valid.
* сеттер errors(value: string) - устанавливает текст ошибок в элементе.
* render(state: Partial<T> & IFormState) - обновляет состояние формы на основе переданных данных о состоянии формы (valid, erorrs, inputs).
* clearForm() - сбрасывает значения полей формы.

__Класс Page__

Позволяет отобразить главную страницу приложения и изменять ее при необходимости. Является наследником класса Component. 

Поля класса: 
* counter: HTMLElement - элемент, отображающий счётчик товаров в корзине в заголовке.
* catalog: HTMLElement - элемент, содержащий каталог товаров.
* wrapper: HTMLElement - элемент - обертка основной страницы.
* basket: HTMLElement - элемент, представляющий корзину, на который можно кликнуть для открытия или отображения корзины.

Конструктор класса: 
в качестве параметров принимает родительский элемент и объект, соответствующий интерфейсу IEvents. Внутри конструктора происходит инициализация полей и навешивание обработчика для открытия корзины товаров.

Методы класса:
* для counter и catalog предусмотрены сеттеры.
* setLocked(value: boolean) - позволяет блокировать и разблокировать прокрутку страницы.

__Класс Card__

Является базовым классом для карточек проекта, предоставляя общий функционал. Является наследником класса Component. 

Поля класса: 
сохранены такие элементы разметки, которые содержат название товара, его стоимость и кнопку для различных действий с товаром. 

Конструктор класса: 
принимает в параметры имя блока строчного типа (для последующего поиска полей в разметке), родительский контейнер (тип HTMLElement), может также принимать объект actions, который можно использовать при навешивании обработчиков событий. 

Содержит сеттеры и геттеры для получения и установления значения полей карточки.

__Класс CardMainPage__

Наполняет содержимым и отрисовывает карточку товара на главной странице. Является наследником класса Card. 

Поля класса: 
сохранены такие элементы разметки, которые содержат изображение, категорию товара, выбран товар или нет, а также объект, позволяющий применять разную стилизацию для разных категорий товаров. 

Конструктор класса: 
принимает в параметры имя блока строчного типа (для последующего поиска полей в разметке), родительский контейнер (тип HTMLElement), может также принимать объект actions, который можно использовать при навешивании обработчиков событий. 

Содержит сеттеры и геттеры для получения и установления значения полей карточки.

__Класс CardPreview__

Позволяет отрисовать карточку товара с подробным описанием товара. Является наследником класса CardMainPage. 

Поля класса: 
сохранен такой элемент разметки, который содержит подробное описание товара.

Конструктор класса: 
принимает в параметры родительский контейнер (тип HTMLElement), может также принимать объект actions, который можно использовать при навешивании обработчиков событий. 

Содержит сеттер для установления значения поля с описанием товара.

__Класс BasketCard__

Наполняет содержимым и отрисовывает карточку товара в корзине. Является наследником класса Card. 

Поля класса: 
сохранены такой элемент разметки, который содержат порядковый номер товара в корзине. 

Конструктор класса: 
принимает в параметры родительский контейнер (тип HTMLElement), может также принимать объект actions, который можно использовать при навешивании обработчиков событий. 

Содержит сеттер для установления значения поля карточки.


__Класс Basket__

Управляет отображением содержимого корзины. Является наследником класса Component. 

Поля класса: 
сохранены такие элементы разметки, которые содержат список товаров, общую стоимость товаров, кнопку оформления заказа.

Конструктор класса: 
В качестве параметров принимает родительский контейнер (тип HTMLElement) и объект, соответствующий интерфейсу IEvents.

Методы класса: 
* для полей со списком товаров и стоимостью товаров предусмотрены сеттеры. 
* disableBasketBtn - позволяет заблокировать кнопку "Оформить", если корзина пуста.

__Класс FormOrder__

Управляет формой заказа. Является наследником класса Form. 

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат кнопки выбора способа оплаты, поле ввода адреса. 

Конструктор класса: в качестве параметра принимает шаблон формы и объект, соответствующий интерфейсу IEvents. В конструкторе происходит инициализация полей, навешивание слушателей событий на кнопки выбора способа оплаты.

__Класс FormContacts__

Управляет формой заполнения контактных данных. Является наследником класса Form. 

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат два поля ввода контактной информации. 

Конструктор класса: в качестве параметра принимает шаблон формы и объект, соответствующий интерфейсу IEvents. В конструкторе происходит инициализация полей.

Методы класса:
* предусмотрены сеттеры для полей email и phone
* changeBtnText(text: string) - позволяет изменить текст кнопки (в частности, на период отправки данных).

__Класс PopupSucces__

Управляет отображением окна успешного оформления заказа. Является наследником класса Component.

Поля класса: 
Будут сохранены такие элементы разметки, которые содержат кнопку закрытия, списанную сумму за заказ.

Конструктор класса: 
принимает в качестве параметров родительский элемент, содержащий компоненты сообщения об успехе, и объект actions: ISuccessActions, содержащий действия, которые могут быть выполнены в ответ на события, происходящие в компоненте (в частности, для обработки клика по кнопке закрытия).

Методы класса: 
* будет предусмотрен сеттер для указания списанной суммы (в параметры принимает сумму).


### События в проекте:

В проекте использован ряд событий, о которых будут оповещаться подписчики. 

* catalog:changed - обновление списка товаров на странице. Изначально массив товаров получается с сервера через экземпляр класса ApiAddition и записывается в поле catalog класса AppState. Далее перерисовывается главная страница с помощью классов Page и Card
* card:select - по клику на карточку на главной странице открывается модальное окно с подробным описанием товара
* card:deletefromPreview - по клику на кнопку в карточке с подробным описанием товара происходит удаление товара из корзины, если товар ранее был туда добавлен
* card:toBasket - при клике на кнопку "в корзину" выбранный товар добавляется в массив товаров, хранящийся в корзине, при этом также обновляется счетчик товаров в корзине, а кнопка "в корзину" становится неактивной
* basket:open - открытие корзины в модальном окне по клику на кнопку на главной странице
* card:delete - товар удаляется из массива товаров в корзине, перерисовывается корзина, обновляется счетчик товаров, кнопка "в корзину" у товара снова становится активной
* basket:makeOrder - при клике на кнопку "оформить" открывается новое окно с формой заказа (выбора способа оплаты и ввода адреса)
* orderFormErrors:change - обновляет состояние формы заказа в зависимости от текущих ошибок валидации
* contactsFormErrors:change - обновляет состояние формы ввода контактных данных в зависимости от текущих ошибок валидации
* orderInput:change - реагирует на изменения ввода данных в полях форм, размещенных на сайте, записывает значения в определенные поля экземпляра класса AppState
* order:submit - при клике на кнопку "далее" в форме заказа открывается окно с заполнением контактных данных
* contacts:submit - при клике на кнопку "оплатить" в форме заполнения контактных данных информация о заказе отправляется на сервер; при успешной обработке заказа на сервере, открывает модальное окно с сообщением об успешной покупке
* modal:open - вызывается при открытии модального окна, позволяет заблокировать прокрутку страницы
* modal:closed - вызывается при нажатии на кнопку закрытия модального окна или при клике на область вне модального окна, разблокирует прокрутку страницы

---
Разработка архитектуры и функционала выполнено в рамках обучения на курсе "Яндекс-Практикума". Автор благодарит команду "Яндекс-Практикума" за предоставленную верстку и настройки проекта.
